<!DOCTYPE html><html lang="en"> <head><meta charset="utf-8"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><meta name="viewport" content="width=device-width"><meta name="generator" content="Astro v4.11.3"><title>Ravenports: making a dasm port</title><link rel="stylesheet" href="/_astro/about.ziih_YEc.css">
<style>html{background-color:#2e3440;font-family:sans-serif;margin:20px}header{background-color:#434c5e;border-radius:25px;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px)}footer{background-color:#434c5e;border-radius:25px}footer a:hover,footer a:focus{background-color:#81a1c1;border-radius:25px}body{margin:0 auto;width:100%;max-width:80ch;padding:1rem;line-height:1.5;color:#d8dee9;background-color:#4c566a;border-radius:25px}.body-content{padding:20px}.body-content ul{margin-left:30px}*{box-sizing:border-box}h1{margin:1rem 0;font-size:2.5rem;color:#d8dee9}ul{list-style:circle}.blog-links a{color:#ebcb8b}.blog-links li{list-style:circle}.hamburger{padding:10px 20px;cursor:pointer}.hamburger .line{display:block;width:30px;height:5px;margin-top:10px;margin-bottom:10px;background-color:#eceff4}.nav-links{width:100%;top:5rem;left:48px;background-color:#a09c96;display:none;margin:0;color:#d8dee9}.nav-links a{display:block;text-align:center;padding:10px 0;text-decoration:none;font-size:1.2rem;font-weight:700;text-transform:uppercase;background-color:#5e81ac;border-radius:25px}.nav-links a:hover,.nav-links a:focus{background-color:#81a1c1;border-radius:25px}.expanded{display:unset}@media screen and (min-width: 636px){.nav-links{margin-left:5em;display:block;position:static;width:auto;background:none}.nav-links a{display:inline-block;padding:15px 20px}.hamburger{display:none}}a[data-astro-cid-yxtifmrq]{padding:.5rem 1rem;color:#fff;background-color:#5e81ac;text-decoration:none;border-radius:25px}footer[data-astro-cid-sz7xmlte]{display:flex;gap:1rem;margin-top:2rem}
</style><script type="module">document.querySelector(".hamburger").addEventListener("click",()=>{document.querySelector(".nav-links").classList.toggle("expanded")});
</script></head> <body> <header> <nav> <div class="hamburger"> <span class="line"></span> <span class="line"></span> <span class="line"></span> </div> <div class="nav-links"> <a href="/">Home</a> <a href="/about/">About</a> <a href="/blog/">Blog</a> </div> </nav> </header> <h1>Ravenports: making a dasm port</h1> <div class="body-content">  <p>Written by Todd</p> <p>Published on: 2023-01-24</p> <p>My first <a href="https://martintc.tech/post/ravenports-dwm/">article</a> for making a port was a little complex. In this post, I will cover some of the details for making a simpler port for Ravenports. To view all the files, you can reference the <a href="https://github.com/Ravenports/ravensource/pull/248/files">pull request</a> that was approved and pulled into Ravensource.</p>
<p>First, covering some of the workflow for creating a new port in Ravenports. For myself, since I am being mentored, I am pulling directly against the <a href="https://github.com/Ravenports/ravensource">ravensource repository</a>. However, there is the <a href="https://github.com/Ravenports/customsource">custom source</a> repository which is meant for new contributors and for WIP (Work In Progress) ports. Over time, often many times a week, a “release” is rather cut from ravensource and the ports tree is generated. This ports tree is the <a href="https://github.com/Ravenports/ravenports">ravenports</a> repository. Then from here, a more official release is cut. From my understanding, this is when all the packages in the ports tree are compiled for all targeted architectures and will be made available through the binary package manager, ravensw.</p>
<p>Next, always starting with the specification.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="sh"><code><span class="line"><span style="color:#E1E4E8">  DEF[PORTVERSION]</span><span style="color:#F97583">=</span><span style="color:#B392F0">	2.20.14.1</span></span>
<span class="line"><span style="color:#6A737D">  # ----------------------------------------------------------------------------</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">  NAMEBASE</span><span style="color:#F97583">=</span><span style="color:#B392F0">		dasm</span></span>
<span class="line"><span style="color:#E1E4E8">  VERSION</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">		${PORTVERSION}</span></span>
<span class="line"><span style="color:#E1E4E8">  KEYWORDS</span><span style="color:#F97583">=</span><span style="color:#B392F0">		devel</span><span style="color:#9ECBFF"> lang</span></span>
<span class="line"><span style="color:#E1E4E8">  VARIANTS</span><span style="color:#F97583">=</span><span style="color:#B392F0">		standard</span></span>
<span class="line"><span style="color:#E1E4E8">  SDESC[standard]</span><span style="color:#F97583">=</span><span style="color:#B392F0">	Versatile</span><span style="color:#9ECBFF"> macro</span><span style="color:#9ECBFF"> assembler</span><span style="color:#9ECBFF"> for</span><span style="color:#9ECBFF"> 8bit</span><span style="color:#9ECBFF"> microprocessors</span></span>
<span class="line"><span style="color:#E1E4E8">  HOMEPAGE</span><span style="color:#F97583">=</span><span style="color:#B392F0">		https://dasm-assembler.github.io</span></span>
<span class="line"><span style="color:#E1E4E8">  CONTACT</span><span style="color:#F97583">=</span><span style="color:#B392F0">		Todd_Martin[warfox@sdf.org]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">  DOWNLOAD_GROUPS</span><span style="color:#F97583">=</span><span style="color:#B392F0">	main</span></span>
<span class="line"><span style="color:#E1E4E8">  SITES[main]</span><span style="color:#F97583">=</span><span style="color:#B392F0">		GITHUB/dasm-assembler:dasm:$</span><span style="color:#9ECBFF">{PORTVERSION}</span></span>
<span class="line"><span style="color:#E1E4E8">  DISTFILE[1]</span><span style="color:#F97583">=</span><span style="color:#B392F0">		generated:main</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">  SPKGS[standard]</span><span style="color:#F97583">=</span><span style="color:#B392F0">	single</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">  OPTIONS_AVAILABLE</span><span style="color:#F97583">=</span><span style="color:#B392F0">	none</span></span>
<span class="line"><span style="color:#E1E4E8">  OPTIONS_STANDARD</span><span style="color:#F97583">=</span><span style="color:#B392F0">	none</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">  LICENSE</span><span style="color:#F97583">=</span><span style="color:#B392F0">		GPLv2:single</span></span>
<span class="line"><span style="color:#E1E4E8">  LICENSE_FILE</span><span style="color:#F97583">=</span><span style="color:#B392F0">		GPLv2:</span><span style="color:#9ECBFF">{{WRKSRC}</span><span style="color:#B392F0">}/LICENSE</span></span>
<span class="line"><span style="color:#E1E4E8">  LICENSE_TERMS</span><span style="color:#F97583">=</span><span style="color:#B392F0">		single:</span><span style="color:#9ECBFF">{{WRKDIR}</span><span style="color:#B392F0">}/TERMS</span></span>
<span class="line"><span style="color:#E1E4E8">  LICENSE_SOURCE</span><span style="color:#F97583">=</span><span style="color:#B392F0">		TERMS:</span><span style="color:#9ECBFF">{{WRKSRC}</span><span style="color:#B392F0">}/src/main.c</span></span>
<span class="line"><span style="color:#E1E4E8">  LICENSE_AWK</span><span style="color:#F97583">=</span><span style="color:#B392F0">		TERMS:</span><span style="color:#B392F0">"^</span><span style="color:#79B8FF">$$</span><span style="color:#B392F0">"</span></span>
<span class="line"><span style="color:#E1E4E8">  LICENSE_SCHEME</span><span style="color:#F97583">=</span><span style="color:#B392F0">	solo</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">  FPC_EQUIVALENT</span><span style="color:#F97583">=</span><span style="color:#B392F0">	devel/dasm</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">  USES</span><span style="color:#F97583">=</span><span style="color:#B392F0">			gmake</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">  post-stage:</span><span style="color:#E1E4E8">		${STRIP_CMD} ${STAGEDIR}${PREFIX}</span><span style="color:#9ECBFF">/bin/</span><span style="color:#79B8FF">*</span></span>
<span class="line"></span></code></pre>
<p>Here the version number is set, so is the namebase along with other basic information on the port. The interesting bit is with the <code>DOWNLOAD_GROUPS</code>. Here, the source is being pulled form github. As of this writing, <a href="https://github.com/Ravenports/Ravenports/wiki/Chapter-11">chapter 11</a> of the wiki in the ravenports repository covers the basic usage of pulling sources from a github repository. Although, <a href="https://github.com/Ravenports/Ravenports/wiki/Sites">many</a> are also covered such as OpenBSD mirrors, GNU’s mirrors, and SourceForge are commons ones that can be found being used when going through specification files.</p>
<p>Only a single package of package type single is defined with no options, however the license sections gets a little interesting. DASM is licensed with GPLv2. What is required here is a license file and a terms file. The license file is rather simple, most repositories have a LICENSE or License.txt file which should contain this as is the case in DASM. However, the terms are a little tricky. I am still not 100% on the details of this, but most of the time, the terms can be found in a source file as usually the header. Which what I have done here is use awk to go and grab those license terms. For DASM, these are the license terms.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="sh"><code><span class="line"><span style="color:#B392F0">  /*</span></span>
<span class="line"><span style="color:#B392F0">    the</span><span style="color:#9ECBFF"> DASM</span><span style="color:#9ECBFF"> macro</span><span style="color:#9ECBFF"> assembler</span><span style="color:#E1E4E8"> (aka </span><span style="color:#9ECBFF">small</span><span style="color:#9ECBFF"> systems</span><span style="color:#9ECBFF"> cross</span><span style="color:#9ECBFF"> assembler</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#B392F0">    Copyright</span><span style="color:#E1E4E8"> (c) 1988-2002 by Matthew Dillon.</span></span>
<span class="line"><span style="color:#B392F0">    Copyright</span><span style="color:#E1E4E8"> (c) 1995 by Olaf </span><span style="color:#9ECBFF">"Rhialto"</span><span style="color:#E1E4E8"> Seibert.</span></span>
<span class="line"><span style="color:#B392F0">    Copyright</span><span style="color:#E1E4E8"> (c) 2003-2008 by Andrew Davie.</span></span>
<span class="line"><span style="color:#B392F0">    Copyright</span><span style="color:#E1E4E8"> (c) 2008 by Peter H. Froehlich.</span></span>
<span class="line"><span style="color:#B392F0">    This</span><span style="color:#9ECBFF"> program</span><span style="color:#9ECBFF"> is</span><span style="color:#9ECBFF"> free</span><span style="color:#9ECBFF"> software</span><span style="color:#E1E4E8">; </span><span style="color:#B392F0">you</span><span style="color:#9ECBFF"> can</span><span style="color:#9ECBFF"> redistribute</span><span style="color:#9ECBFF"> it</span><span style="color:#9ECBFF"> and/or</span><span style="color:#9ECBFF"> modify</span></span>
<span class="line"><span style="color:#B392F0">    it</span><span style="color:#9ECBFF"> under</span><span style="color:#9ECBFF"> the</span><span style="color:#9ECBFF"> terms</span><span style="color:#9ECBFF"> of</span><span style="color:#9ECBFF"> the</span><span style="color:#9ECBFF"> GNU</span><span style="color:#9ECBFF"> General</span><span style="color:#9ECBFF"> Public</span><span style="color:#9ECBFF"> License</span><span style="color:#9ECBFF"> as</span><span style="color:#9ECBFF"> published</span><span style="color:#9ECBFF"> by</span></span>
<span class="line"><span style="color:#B392F0">    the</span><span style="color:#9ECBFF"> Free</span><span style="color:#9ECBFF"> Software</span><span style="color:#9ECBFF"> Foundation</span><span style="color:#E1E4E8">; </span><span style="color:#B392F0">either</span><span style="color:#9ECBFF"> version</span><span style="color:#79B8FF"> 2</span><span style="color:#9ECBFF"> of</span><span style="color:#9ECBFF"> the</span><span style="color:#9ECBFF"> License,</span><span style="color:#9ECBFF"> or</span></span>
<span class="line"><span style="color:#E1E4E8">    (</span><span style="color:#B392F0">at</span><span style="color:#9ECBFF"> your</span><span style="color:#9ECBFF"> option</span><span style="color:#E1E4E8">) </span><span style="color:#B392F0">any</span><span style="color:#9ECBFF"> later</span><span style="color:#9ECBFF"> version.</span></span>
<span class="line"><span style="color:#B392F0">    This</span><span style="color:#9ECBFF"> program</span><span style="color:#9ECBFF"> is</span><span style="color:#9ECBFF"> distributed</span><span style="color:#9ECBFF"> in</span><span style="color:#9ECBFF"> the</span><span style="color:#9ECBFF"> hope</span><span style="color:#9ECBFF"> that</span><span style="color:#9ECBFF"> it</span><span style="color:#9ECBFF"> will</span><span style="color:#9ECBFF"> be</span><span style="color:#9ECBFF"> useful,</span></span>
<span class="line"><span style="color:#B392F0">    but</span><span style="color:#9ECBFF"> WITHOUT</span><span style="color:#9ECBFF"> ANY</span><span style="color:#9ECBFF"> WARRANTY</span><span style="color:#E1E4E8">; </span><span style="color:#B392F0">without</span><span style="color:#9ECBFF"> even</span><span style="color:#9ECBFF"> the</span><span style="color:#9ECBFF"> implied</span><span style="color:#9ECBFF"> warranty</span><span style="color:#9ECBFF"> of</span></span>
<span class="line"><span style="color:#B392F0">    MERCHANTABILITY</span><span style="color:#9ECBFF"> or</span><span style="color:#9ECBFF"> FITNESS</span><span style="color:#9ECBFF"> FOR</span><span style="color:#9ECBFF"> A</span><span style="color:#9ECBFF"> PARTICULAR</span><span style="color:#9ECBFF"> PURPOSE.</span><span style="color:#9ECBFF">  See</span><span style="color:#9ECBFF"> the</span></span>
<span class="line"><span style="color:#B392F0">    GNU</span><span style="color:#9ECBFF"> General</span><span style="color:#9ECBFF"> Public</span><span style="color:#9ECBFF"> License</span><span style="color:#9ECBFF"> for</span><span style="color:#9ECBFF"> more</span><span style="color:#9ECBFF"> details.</span></span>
<span class="line"><span style="color:#B392F0">    You</span><span style="color:#9ECBFF"> should</span><span style="color:#9ECBFF"> have</span><span style="color:#9ECBFF"> received</span><span style="color:#9ECBFF"> a</span><span style="color:#9ECBFF"> copy</span><span style="color:#9ECBFF"> of</span><span style="color:#9ECBFF"> the</span><span style="color:#9ECBFF"> GNU</span><span style="color:#9ECBFF"> General</span><span style="color:#9ECBFF"> Public</span><span style="color:#9ECBFF"> License</span><span style="color:#9ECBFF"> along</span></span>
<span class="line"><span style="color:#B392F0">    with</span><span style="color:#9ECBFF"> this</span><span style="color:#9ECBFF"> program</span><span style="color:#E1E4E8">; </span><span style="color:#F97583">if</span><span style="color:#B392F0"> not,</span><span style="color:#9ECBFF"> write</span><span style="color:#9ECBFF"> to</span><span style="color:#9ECBFF"> the</span><span style="color:#9ECBFF"> Free</span><span style="color:#9ECBFF"> Software</span><span style="color:#9ECBFF"> Foundation,</span><span style="color:#9ECBFF"> Inc.,</span></span>
<span class="line"><span style="color:#B392F0">    51</span><span style="color:#9ECBFF"> Franklin</span><span style="color:#9ECBFF"> Street,</span><span style="color:#9ECBFF"> Fifth</span><span style="color:#9ECBFF"> Floor,</span><span style="color:#9ECBFF"> Boston,</span><span style="color:#9ECBFF"> MA</span><span style="color:#9ECBFF"> 02110-1301</span><span style="color:#9ECBFF"> USA.</span></span>
<span class="line"><span style="color:#B392F0">  */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">  /*</span></span>
<span class="line"><span style="color:#B392F0">   *</span><span style="color:#9ECBFF">  MAIN.C</span></span>
<span class="line"><span style="color:#B392F0">   *</span><span style="color:#9ECBFF">  DASM</span><span style="color:#9ECBFF">   sourcefile</span></span>
<span class="line"><span style="color:#B392F0">   *</span><span style="color:#9ECBFF">  NOTE:</span><span style="color:#9ECBFF"> must</span><span style="color:#9ECBFF"> handle</span><span style="color:#9ECBFF"> mnemonic</span><span style="color:#9ECBFF"> extensions</span><span style="color:#9ECBFF"> and</span><span style="color:#9ECBFF"> expression</span><span style="color:#9ECBFF"> decode/compare.</span></span>
<span class="line"><span style="color:#B392F0">   */</span></span>
<span class="line"></span></code></pre>
<p>Next, specifying that gmake is used to build this port. Ravenadm will automatically call the generic</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="sh"><code><span class="line"><span style="color:#B392F0">      gmake</span><span style="color:#79B8FF"> -f</span><span style="color:#9ECBFF"> Makefile</span><span style="color:#79B8FF"> -j4</span><span style="color:#9ECBFF"> all</span></span>
<span class="line"></span></code></pre>
<p>Where the ‘j’ option is dependant on <code>Max. jobs per builder</code> specified in the ravenadm configuration tool.</p>
<p>Then to finish off, the last bit of the specification is stripping the binaries. At a surface level, some binaries and libraries are compiled with everything for debugging, this is the <code>-g</code> switch when compiling in most C compilers. Stripping will strip this out of the binaries or libraries since that is not needed for someone to just use the produced binary. This occurs in the <code>post-stage</code> and ravenports gives us some nice short hands. <code>${STRIP_CMD}</code> will be the strip command as the name implies. <code>${STAGEDIR}${PREFIX}</code> will take us to where ravenports stages these files for packaging. I do use an asterick for all files in the <code>bin</code> directory since DASM does compile and make two binaries; dasm and ftohex.</p>
<p>Outputs that end up in the final package can be found in <code>manifests/plist.single</code>. This is a list of all files that will be in the package generated. As it can be seen, there are listing for both binaries this package makes when compiling. Ravenports also lists the path starting after <code>${STAGEDIR}${PREFIX}</code> since it knows to fill what is needed later on.</p>
<p>This port did require a single patch to the makefile. This actually was not necessary as it could have been handled in the specification during on of the pre- or post- stages. However, I instead implemented the install block in the Makefile.</p>
<p>This is a pretty good sample of a simpler port than the dwm port that was covered in a previous article.</p>  </div> <footer data-astro-cid-sz7xmlte> <a href="https://www.github.com/martintc" data-astro-cid-yxtifmrq>github</a>  </footer>  </body> </html>